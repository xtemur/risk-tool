# **Day-Ahead Risk Scout**
*Predictive risk signals & behavioral analytics for active traders*

---

## 1 · Purpose & Vision
Day-Ahead Risk Scout (DARS) turns raw trade execution logs into **actionable, probability-based risk warnings** and **behavioral insights**.
The goal: **keep discretionary day-traders out of their own danger zones**, preserve firm capital, and compound long-term PnL.

---

## 2 · Core Capabilities

| Area | What it Does | Outcome |
|------|--------------|---------|
| **Daily Risk Engine** | Calibrated probability that a trader’s *next* trading day will close negative. | “Rest-day” alerts with confidence score & top risk factors |
| **Intraday Guard (optional)** | Real-time anomaly scan on fills stream (position spikes, rapid loss cascades). | Mid-session warnings, position-size throttling hooks |
| **Weekly Analytics Pack** | Autogenerated PDF/HTML dashboard: drawdowns, win-rate drift, behavioral flags, model hit-rate. | Transparent review meeting artefact |
| **Explainability Layer** | SHAP-based per-alert feature breakdown. | Trader coaching & management trust |
| **MLOps Loop** | Time-series CV, drift diagnostics, weekly retrain & rollback, model registry. | Robustness, auditable model lineage |
| **Integrations** | Email/Slack push, REST API, optional Streamlit dashboard. | Low-friction adoption in any desk workflow |

---

## 3 · Data Inputs

| Source | Minimum Fields Needed |
|--------|-----------------------|
| **Fills (intraday)** | `datetime`, `account_id`, `trader_name`, `symbol`, `price`, `qty`, `order_id`, `total_fee` |
| **Daily Totals** | `date`, `orders_cnt`, `fills_cnt`, `qty_cnt`, `gross`, `net_pnl`, `unrealized_delta`, `total_delta` |
| *(Optional)* Market context (e.g. VIX), peer benchmarks |

All data ingested as CSV or pulled via propreports.com API; persisted in **/data/raw/**, then normalized into parquet for speed & idempotency.

---

## 4 · Model Methodology

1. **Feature Blocks**
   - Rolling stats (3-, 5-, 10-day mean, std, max drawdown)
   - Equity-curve momentum & volatility-adjusted PnL
   - Trade-behavior metrics (avg position size, burst frequency, time-of-day PnL skew)
   - Market regime tags (volatility quantile, trend vs. chop)

2. **Learner**
   - Default: LightGBM binary classifier → `P(loss tomorrow)`
   - Ensemble option: Gradient-boost + sequence Transformer (attention over 30-day sequences)

3. **Validation**
   - Purged, rolling time-series CV
   - Metrics: AUC, recall@70%-precision, expected-value lift

4. **Thresholding**
   - Cut-point chosen on validation set to maximize F1 or desk-defined cost matrix.

5. **Explainability**
   - SHAP summary stored with every prediction → served via API/report.

---

## 5 · System Architecture

```
         ┌─────────┐   raw csv   ┌─────────┐
   API → │ Ingest  │────────────→│  Lake   │
         └─────────┘            /└─────────┘
                                 ▼
            nightly           ┌───────┐
         ┌─────────┐ parquet  │Feature│
         │ Cleaner │─────────→│Engine │
         └─────────┘          └───────┘
                                 ▼              weekly
                              ┌──────┐         retrain
           daily              │Model │◄────────────────┐
         ┌────────┐ features  │Store │                │
         │Predict │──────────→└──────┘                │
         └────────┘  probs        │                   │
              │                   │                   │
         SHAP │                   ▼                   │
              │            ┌──────────┐               │
              └───────────→│ Alert/   │──────────────→│
                           │ Report   │  metrics      │
                           └──────────┘               ▼
                                                MLflow / Evidently
```

All components shipped as Docker services; tasks orchestrated by **Prefect** DAG (cron: daily 06:30, weekly Sun 20:00 UTC+5).

---

## 6 · Installation (dev mode)

```bash
git clone https://github.com/acme/dars.git
cd dars
python -m venv .venv && source .venv/bin/activate
pip install -r requirements.txt  # no Conda
cp .env.example .env             # set API keys & email creds
prefect deployment apply flows/daily_run.py
```

---

## 7 · Quick Start

1. Drop historical `fills_*.csv` and `totals_*.csv` into **/data/raw/**.
2. Run first training:

```bash
python scripts/initial_train.py --lookback_days 365
```

3. Trigger prediction (prints JSON + sends email):

```bash
python scripts/predict_today.py --date 2025-05-30
```

4. View last weekly report in **/reports/weekly/**.

---

## 8 · Configuration Highlights (`config.yaml`)

```yaml
risk:
  prob_threshold: 0.70          # High-risk cut-off
  lookback_days: [3, 5, 10]
  loss_cap: -500                # $; for magnitude model

alerts:
  channels: ["email", "slack"]
  email_recipients: ["risk@firm.com"]

training:
  retrain_freq: 7d
  model_type: "lgbm"
```

---

## 9 · Security & Compliance

- All data stored encrypted-at-rest (AES-256).
- Role-based API tokens; no trader PII leaves firm network.
- Full audit trail for model versions, predictions, manual overrides.

---

## 10 · Roadmap

| Q | Planned Upgrade |
|---|-----------------|
| **Q3 2025** | Intraday Guard real-time Kafka pipeline |
| **Q4 2025** | Peer-adjusted risk layer; firm-wide VaR aggregation |
| **Q1 2026** | Auto-remediation API hooks (auto-reduce max position) |
| **Q2 2026** | Cloud-agnostic deploy (Terraform, k8s) & multi-tenant SaaS |
